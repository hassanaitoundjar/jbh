<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Drawing Recolor Tool</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            max-width: 1400px;
            width: 100%;
        }
        h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 24px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }
        .upload-area {
            border: 2px dashed #92abc7;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f9fbfd;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            border-color: #7a95b0;
            background: #f0f5f9;
        }
        .upload-area.dragover {
            border-color: #5a7590;
            background: #e8f0f7;
        }
        input[type="file"] {
            display: none;
        }
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
            color: #92abc7;
        }
        .canvas-container {
            margin: 20px 0;
            text-align: center;
        }
        .canvas-wrapper {
            background: 
                repeating-conic-gradient(#e8e8e8 0% 25%, #ffffff 0% 50%) 
                50% / 24px 24px;
            padding: 20px;
            display: inline-block;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        canvas {
            max-width: 100%;
            display: block;
            border: 1px solid #ddd;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .control-group {
            background: #f9fbfd;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e8eef4;
        }
        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 13px;
            color: #555;
            font-weight: 500;
        }
        .color-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        input[type="color"] {
            width: 60px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            background: white;
        }
        input[type="text"] {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #92abc7;
            cursor: pointer;
            transition: all 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #7a95b0;
            transform: scale(1.1);
        }
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #92abc7;
            cursor: pointer;
            border: none;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            background: #92abc7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s;
            flex: 1;
        }
        button:hover {
            background: #7a95b0;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(146, 171, 199, 0.3);
        }
        button:active {
            transform: translateY(0);
        }
        button.secondary {
            background: #e8eef4;
            color: #555;
        }
        button.secondary:hover {
            background: #d8e4f0;
        }
        .info {
            background: #f0f5f9;
            padding: 12px 16px;
            border-radius: 6px;
            color: #555;
            font-size: 13px;
            margin-top: 15px;
        }
        .preset-colors {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .preset-color {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid #ddd;
            transition: all 0.2s;
        }
        .preset-color:hover {
            transform: scale(1.1);
            border-color: #999;
        }
        .help-text {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Custom Drawing Recolor Tool</h1>
        <div class="subtitle">
            Choose your color and adjust stroke width for architectural drawings
        </div>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">üìê</div>
            <div><strong>Click to upload</strong> or drag and drop your drawing</div>
            <div style="font-size: 12px; color: #999; margin-top: 8px;">PNG, JPG, or any image format</div>
            <input type="file" id="fileInput" accept="image/*">
        </div>
        
        <div class="controls" id="controls" style="display: none;">
            <div class="control-group">
                <div class="control-label">
                    <span>Line Color</span>
                </div>
                <div class="color-input-wrapper">
                    <input type="color" id="colorPicker" value="#92abc7">
                    <input type="text" id="colorHex" value="#92abc7" placeholder="#92abc7">
                </div>
                <div class="preset-colors">
                    <div class="preset-color" style="background: #92abc7;" data-color="#92abc7" title="Original Blue-Gray"></div>
                    <div class="preset-color" style="background: #000000;" data-color="#000000" title="Black"></div>
                    <div class="preset-color" style="background: #2c3e50;" data-color="#2c3e50" title="Dark Gray"></div>
                    <div class="preset-color" style="background: #3498db;" data-color="#3498db" title="Blue"></div>
                    <div class="preset-color" style="background: #27ae60;" data-color="#27ae60" title="Green"></div>
                    <div class="preset-color" style="background: #e74c3c;" data-color="#e74c3c" title="Red"></div>
                    <div class="preset-color" style="background: #8e44ad;" data-color="#8e44ad" title="Purple"></div>
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-label">
                    <span>Stroke Width</span>
                    <span id="strokeValue">1.0x</span>
                </div>
                <input type="range" id="strokeWidth" min="0.5" max="3" value="1" step="0.1">
                <div class="help-text">
                    Adjust line thickness (1.0 = original)
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-label">
                    <span>Transparency Threshold</span>
                    <span id="thresholdValue">240</span>
                </div>
                <input type="range" id="threshold" min="200" max="255" value="240" step="1">
                <div class="help-text">
                    Higher = more background removed
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-label">
                    <span>Background Color</span>
                </div>
                <div class="color-input-wrapper">
                    <input type="color" id="bgColorPicker" value="#ffffff">
                    <input type="text" id="bgColorHex" value="#ffffff" placeholder="#ffffff">
                </div>
                <label style="display: flex; align-items: center; gap: 8px; margin-top: 10px; font-size: 12px; cursor: pointer;">
                    <input type="checkbox" id="transparentBg" checked>
                    <span>Transparent Background</span>
                </label>
                <div class="preset-colors">
                    <div class="preset-color" style="background: #ffffff; border: 2px solid #ccc;" data-bgcolor="#ffffff" title="White"></div>
                    <div class="preset-color" style="background: #f5f5f5;" data-bgcolor="#f5f5f5" title="Light Gray"></div>
                    <div class="preset-color" style="background: #000000;" data-bgcolor="#000000" title="Black"></div>
                    <div class="preset-color" style="background: #2c3e50;" data-bgcolor="#2c3e50" title="Dark Blue"></div>
                    <div class="preset-color" style="background: #ecf0f1;" data-bgcolor="#ecf0f1" title="Light Blue"></div>
                    <div class="preset-color" style="background: #ffe5b4;" data-bgcolor="#ffe5b4" title="Peach"></div>
                </div>
            </div>
        </div>
        
        <div class="button-group" id="buttonGroup" style="display: none;">
            <button id="applyBtn" class="secondary">üîÑ Apply Changes</button>
            <button id="downloadBtn">‚¨á Download PNG</button>
        </div>
        
        <div class="canvas-container" id="canvasContainer" style="display: none;">
            <div class="canvas-wrapper">
                <canvas id="canvas"></canvas>
            </div>
        </div>
        
        <div class="info" id="info" style="display: none;">
            <strong>‚úì Ready!</strong> Adjust the color and stroke width, then click "Apply Changes" to see the result.
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const controls = document.getElementById('controls');
        const buttonGroup = document.getElementById('buttonGroup');
        const canvasContainer = document.getElementById('canvasContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        const applyBtn = document.getElementById('applyBtn');
        const info = document.getElementById('info');
        const colorPicker = document.getElementById('colorPicker');
        const colorHex = document.getElementById('colorHex');
        const strokeSlider = document.getElementById('strokeWidth');
        const strokeValue = document.getElementById('strokeValue');
        const thresholdSlider = document.getElementById('threshold');
        const thresholdValue = document.getElementById('thresholdValue');
        const bgColorPicker = document.getElementById('bgColorPicker');
        const bgColorHex = document.getElementById('bgColorHex');
        const transparentBg = document.getElementById('transparentBg');

        let currentImage = null;
        let originalImageData = null;

        // Preset colors
        document.querySelectorAll('.preset-color').forEach(preset => {
            preset.addEventListener('click', function() {
                const color = this.dataset.color;
                if (color) {
                    colorPicker.value = color;
                    colorHex.value = color;
                }
                const bgcolor = this.dataset.bgcolor;
                if (bgcolor) {
                    bgColorPicker.value = bgcolor;
                    bgColorHex.value = bgcolor;
                    transparentBg.checked = false;
                }
            });
        });

        // Color picker sync
        colorPicker.addEventListener('input', function() {
            colorHex.value = this.value;
        });

        colorHex.addEventListener('input', function() {
            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                colorPicker.value = this.value;
            }
        });

        // Background color picker sync
        bgColorPicker.addEventListener('input', function() {
            bgColorHex.value = this.value;
            transparentBg.checked = false;
        });

        bgColorHex.addEventListener('input', function() {
            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                bgColorPicker.value = this.value;
                transparentBg.checked = false;
            }
        });

        // Transparent checkbox
        transparentBg.addEventListener('change', function() {
            if (this.checked) {
                bgColorPicker.disabled = true;
                bgColorHex.disabled = true;
            } else {
                bgColorPicker.disabled = false;
                bgColorHex.disabled = false;
            }
        });

        // Stroke slider
        strokeSlider.addEventListener('input', function() {
            strokeValue.textContent = parseFloat(this.value).toFixed(1) + 'x';
        });

        // Threshold slider
        thresholdSlider.addEventListener('input', function() {
            thresholdValue.textContent = this.value;
        });

        // Upload area click
        uploadArea.addEventListener('click', () => fileInput.click());

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                loadImage(file);
            }
        });

        // Apply button
        applyBtn.addEventListener('click', () => {
            if (currentImage) {
                processImage(currentImage);
            }
        });

        // Load image
        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    processImage(img);
                    controls.style.display = 'grid';
                    buttonGroup.style.display = 'flex';
                    canvasContainer.style.display = 'block';
                    info.style.display = 'block';
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Convert hex to RGB
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        // Process image
        function processImage(img) {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Apply background color if not transparent
            if (!transparentBg.checked) {
                const bgColor = hexToRgb(bgColorHex.value);
                ctx.fillStyle = bgColorHex.value;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            ctx.drawImage(img, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const threshold = parseInt(thresholdSlider.value);
            const targetColor = hexToRgb(colorHex.value);
            const bgColor = transparentBg.checked ? null : hexToRgb(bgColorHex.value);
            const strokeWidth = parseFloat(strokeSlider.value);
            
            // Store original for stroke adjustment
            if (!originalImageData) {
                originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                const brightness = (r + g + b) / 3;
                
                if (brightness >= threshold) {
                    if (transparentBg.checked) {
                        data[i + 3] = 0;
                    } else {
                        data[i] = bgColor.r;
                        data[i + 1] = bgColor.g;
                        data[i + 2] = bgColor.b;
                        data[i + 3] = 255;
                    }
                } else {
                    const darknessRatio = brightness / 255;
                    data[i] = targetColor.r * darknessRatio;
                    data[i + 1] = targetColor.g * darknessRatio;
                    data[i + 2] = targetColor.b * darknessRatio;
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            // Apply stroke width if needed
            if (strokeWidth !== 1.0) {
                applyStrokeWidth(strokeWidth);
            }
        }

        // Apply stroke width
        function applyStrokeWidth(width) {
            if (width === 1.0) return;
            
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(canvas, 0, 0);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (width > 1.0) {
                // Dilate for thicker lines
                const iterations = Math.round((width - 1) * 2);
                for (let i = 0; i < iterations; i++) {
                    ctx.drawImage(tempCanvas, -1, 0);
                    ctx.drawImage(tempCanvas, 1, 0);
                    ctx.drawImage(tempCanvas, 0, -1);
                    ctx.drawImage(tempCanvas, 0, 1);
                    ctx.drawImage(tempCanvas, 0, 0);
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                }
            } else {
                // For thinner lines, just draw the original
                ctx.drawImage(tempCanvas, 0, 0);
            }
        }

        // Download
        downloadBtn.addEventListener('click', function() {
            const color = colorHex.value.replace('#', '');
            const bgType = transparentBg.checked ? 'transparent' : bgColorHex.value.replace('#', '');
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `drawing-${color}-bg-${bgType}.png`;
                link.href = url;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setTimeout(() => URL.revokeObjectURL(url), 100);
            }, 'image/png');
        });
    </script>
</body>
</html>
